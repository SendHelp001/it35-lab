System.register(["./react-legacy-D6f2pcCm.js","./react-dom-legacy-BGf1v_1T.js","./@ionic-legacy-BoeXj89V.js","./@supabase-legacy-B2VYwVUe.js","./ionicons-legacy-BUGrXMhe.js","./react-router-legacy-DwSSLY7t.js","./bcryptjs-legacy-BufdzroK.js","./react-router-dom-legacy-D21s3Gda.js","./scheduler-legacy-n5ry1zen.js","./@stencil-legacy-FwjShuEB.js","./tslib-legacy-DMjAcL5s.js","./history-legacy-BGLd1RHi.js","./@babel-legacy-kPXcg0db.js","./resolve-pathname-legacy-tVDsokOj.js","./value-equal-legacy-yVwbAJzn.js","./tiny-invariant-legacy-C3I2lKGB.js","./prop-types-legacy-B70qMZ_z.js","./path-to-regexp-legacy-DMfl18ji.js","./isarray-legacy-BGs-Eh0z.js","./hoist-non-react-statics-legacy-Dq64urGs.js"],(function(e,s){"use strict";var n,t,l,a,r,i,o,c,d,h,u,x,j,p,m,g,f,v,y,b,w,C,_,S,I,k,P,E,D,A,O,L,T,z,N,U,F,J,q,M,R,Y,Z,X,V,W,B,K,G,H,$,Q,ee,se,ne,te,le,ae,re;return{setters:[e=>{n=e.r,t=e.j,l=e.R},e=>{a=e.c},e=>{r=e.u,i=e.a,o=e.I,c=e.b,d=e.c,h=e.d,u=e.e,x=e.f,j=e.g,p=e.h,m=e.i,g=e.j,f=e.k,v=e.l,y=e.m,b=e.n,w=e.o,C=e.p,_=e.q,S=e.r,I=e.s,k=e.t,P=e.v,E=e.w,D=e.x,A=e.y,O=e.z,L=e.A,T=e.B,z=e.C,N=e.D,U=e.E,F=e.F,J=e.G,q=e.H,M=e.J,R=e.K,Y=e.L,Z=e.M,X=e.N,V=e.O,W=e.P},e=>{B=e.c},e=>{K=e.p,G=e.b,H=e.s,$=e.a,Q=e.h,ee=e.r,se=e.c},e=>{ne=e.R,te=e.b,le=e.u},e=>{ae=e.b},e=>{re=e.L},null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){var e=document.createElement("style");e.textContent="",document.head.appendChild(e);const s=B("https://yzernezvbwxkornfzxbn.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl6ZXJuZXp2Ynd4a29ybmZ6eGJuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDMyMTI1MzUsImV4cCI6MjA1ODc4ODUzNX0.34sRdyY_9NDzS83SDPp2AZfjanLBer3V4i_7V8Qqa-g"),ie=()=>{const[e]=r(),l=i(),[a,w]=n.useState(""),[C,_]=n.useState(""),[S,I]=n.useState(!1),k=async()=>{let{data:n,error:t}=await s.auth.signInWithPassword({email:a,password:C});if(t)return r="top",i=t.message,e({color:"danger",message:i,duration:1500,position:r}),void I(!0);var r,i;setTimeout((()=>{l.push("/it35-lab/app","forward","replace")}),300)};return t.jsxs(o,{children:[t.jsx(c,{children:t.jsx(d,{children:t.jsx(h,{children:"Login"})})}),t.jsx(u,{className:"",children:t.jsxs(x,{style:{height:"90%"},children:[t.jsx(j,{children:t.jsx(p,{})}),t.jsx(m,{children:t.jsxs(g,{children:[t.jsxs("div",{children:[t.jsx(f,{position:"stacked",children:"Email"}),t.jsx(v,{type:"email",value:a,onIonChange:e=>w(e.detail.value),fill:"outline",errorText:"Invalid email"})]}),t.jsxs("div",{style:{marginTop:10},children:[t.jsx(f,{position:"stacked",children:"Password"}),t.jsx(v,{type:"password",value:C,onIonChange:e=>_(e.detail.value),placeholder:"************",fill:"outline",style:{marginTop:0},children:t.jsx(y,{slot:"end"})})]}),t.jsx(b,{onClick:()=>k(),expand:"block",style:{marginTop:20},children:"Login"}),t.jsx("div",{style:{textAlign:"center",marginTop:"40vh"},children:t.jsx("span",{children:"Don't have an account yet? "})}),t.jsx(b,{routerLink:"/it35-lab/signup",expand:"block",style:{marginTop:10},children:"Signup"})]})})]})})]})},oe=()=>t.jsxs(o,{children:[t.jsx(c,{children:t.jsxs(d,{children:[t.jsx(w,{slot:"start",children:t.jsx(C,{})}),t.jsx(h,{children:"About"})]})}),t.jsx(u,{fullscreen:!0})]}),ce=()=>t.jsxs(o,{children:[t.jsx(c,{children:t.jsxs(d,{children:[t.jsx(w,{slot:"start",children:t.jsx(C,{})}),t.jsx(h,{children:"Favorites"})]})}),t.jsx(u,{fullscreen:!0,children:t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:"Favorites"})})]}),de=()=>t.jsxs(o,{children:[t.jsx(c,{children:t.jsxs(d,{children:[t.jsx(w,{slot:"start",children:t.jsx(C,{})}),t.jsx(h,{children:"Search"})]})}),t.jsx(u,{fullscreen:!0,children:t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:"Search"})})]}),he=()=>{const[e,l]=n.useState([]),[a,r]=n.useState(""),[i,g]=n.useState(null),[y,w]=n.useState(null),[C,z]=n.useState(null),[N,U]=n.useState(!1),[F,J]=n.useState(!1),[q,M]=n.useState({open:!1,event:null,postId:null});return n.useEffect((()=>{(async()=>{var e;const{data:n}=await s.auth.getUser();if(null!=n&&null!==(e=n.user)&&void 0!==e&&null!==(e=e.email)&&void 0!==e&&e.endsWith("@nbsc.edu.ph")){w(n.user);const{data:e,error:t}=await s.from("users").select("user_id, username, user_avatar_url").eq("user_email",n.user.email).single();!t&&e&&(w({...n.user,id:e.user_id}),z(e.username))}})(),(async()=>{const{data:e,error:n}=await s.from("posts").select("*").order("post_created_at",{ascending:!1});n||l(e)})()}),[]),t.jsx(_,{children:t.jsxs(o,{children:[t.jsx(c,{children:t.jsx(d,{children:t.jsx(h,{children:"Posts"})})}),t.jsx(u,{children:y?t.jsxs(t.Fragment,{children:[t.jsxs(x,{children:[t.jsx(j,{children:t.jsx(p,{children:"Create Post"})}),t.jsx(m,{children:t.jsx(v,{value:a,onIonChange:e=>r(e.detail.value),placeholder:"Write a post..."})}),t.jsx("div",{style:{display:"flex",justifyContent:"flex-end",padding:"0.5rem"},children:t.jsx(b,{onClick:async()=>{if(!a||!y||!C)return;const{data:n,error:t}=await s.from("users").select("user_avatar_url").eq("user_id",y.id).single();if(t)return void console.error("Error fetching user avatar:",t);const i=(null==n?void 0:n.user_avatar_url)||"https://ionicframework.com/docs/img/demos/avatar.svg",{data:o,error:c}=await s.from("posts").insert([{post_content:a,user_id:y.id,username:C,avatar_url:i}]).select("*");!c&&o&&l([o[0],...e]),r("")},children:"Post"})})]}),e.map((n=>t.jsxs(x,{style:{marginTop:"2rem"},children:[t.jsx(j,{children:t.jsxs(S,{children:[t.jsx(I,{size:"1.85",children:t.jsx(k,{children:t.jsx("img",{alt:n.username,src:n.avatar_url})})}),t.jsxs(I,{children:[t.jsx(p,{style:{marginTop:"10px"},children:n.username}),t.jsx(P,{children:new Date(n.post_created_at).toLocaleString()})]}),t.jsx(I,{size:"auto",children:t.jsx(b,{fill:"clear",onClick:e=>M({open:!0,event:e.nativeEvent,postId:n.post_id}),children:t.jsx(E,{color:"secondary",icon:K})})})]})}),t.jsx(m,{children:t.jsx(D,{style:{color:"black"},children:t.jsx("h1",{children:n.post_content})})}),t.jsxs(A,{isOpen:q.open&&q.postId===n.post_id,event:q.event,onDidDismiss:()=>M({open:!1,event:null,postId:null}),children:[t.jsx(b,{fill:"clear",onClick:()=>{(e=>{g(e),r(e.post_content),U(!0)})(n),M({open:!1,event:null,postId:null})},children:"Edit"}),t.jsx(b,{fill:"clear",color:"danger",onClick:()=>{(async n=>{await s.from("posts").delete().match({post_id:n}),l(e.filter((e=>e.post_id!==n)))})(n.post_id),M({open:!1,event:null,postId:null})},children:"Delete"})]})]},n.post_id)))]}):t.jsx(f,{children:"Loading..."})}),t.jsxs(O,{isOpen:N,onDidDismiss:()=>U(!1),children:[t.jsx(c,{children:t.jsx(d,{children:t.jsx(h,{children:"Edit Post"})})}),t.jsx(u,{children:t.jsx(v,{value:a,onIonChange:e=>r(e.detail.value),placeholder:"Edit your post..."})}),t.jsxs(L,{children:[t.jsx(b,{onClick:async()=>{if(!a||!i)return;const{data:n,error:t}=await s.from("posts").update({post_content:a}).match({post_id:i.post_id}).select("*");if(!t&&n){const s=n[0];l(e.map((e=>e.post_id===s.post_id?s:e))),r(""),g(null),U(!1),J(!0)}},children:"Save"}),t.jsx(b,{onClick:()=>U(!1),children:"Cancel"})]})]}),t.jsx(T,{isOpen:F,onDidDismiss:()=>J(!1),header:"Success",message:"Post updated successfully!",buttons:["OK"]})]})})},ue=()=>t.jsxs(o,{children:[t.jsx(c,{children:t.jsxs(d,{children:[t.jsx(w,{slot:"start",children:t.jsx(C,{})}),t.jsx(h,{children:"Feed"})]})}),t.jsxs(u,{fullscreen:!0,children:[t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:"Feed"}),t.jsx(he,{})]})]});function xe(){const e=[{name:"Feed",tab:"feed",url:"/it35-lab/app/home/feed",icon:G},{name:"Search",tab:"search",url:"/it35-lab/app/home/search",icon:H},{name:"Favorites",tab:"favorites",url:"/it35-lab/app/home/favorites",icon:$}];return t.jsx(z,{children:t.jsxs(N,{children:[t.jsx(U,{slot:"bottom",children:e.map(((e,s)=>t.jsxs(F,{tab:e.tab,href:e.url,children:[t.jsx(E,{icon:e.icon,children:" "}),t.jsxs(f,{children:[" ",e.name," "]})]},s)))}),t.jsxs(J,{children:[t.jsx(ne,{exact:!0,path:"/it35-lab/app/home/feed",render:ue}),t.jsx(ne,{exact:!0,path:"/it35-lab/app/home/search",render:de}),t.jsx(ne,{exact:!0,path:"/it35-lab/app/home/favorites",render:ce}),t.jsx(ne,{exact:!0,path:"/it35-lab/app/home",children:t.jsx(te,{to:"/it35-lab/app/home/feed"})})]})]})})}const je=()=>{const[e,l]=n.useState(""),[a,r]=n.useState(""),[i,d]=n.useState(""),[h,x]=n.useState(""),[j,p]=n.useState(""),[m,g]=n.useState(""),[f,C]=n.useState(""),[_,P]=n.useState(null),[E,A]=n.useState(null),[O,L]=n.useState(!1),[z,N]=n.useState(""),U=le(),F=n.useRef(null);return n.useEffect((()=>{(async()=>{const{data:e,error:n}=await s.auth.getSession();if(n||!e||!e.session)return N("You must be logged in to access this page."),L(!0),void U.push("/it35-lab/login");const{data:t,error:a}=await s.from("users").select("user_firstname, user_lastname, user_avatar_url, user_email, username").eq("user_email",e.session.user.email).single();if(a||!t)return N("User data not found."),void L(!0);p(t.user_firstname||""),g(t.user_lastname||""),A(t.user_avatar_url),l(t.user_email),C(t.username||"")})()}),[U]),t.jsxs(o,{children:[t.jsx(c,{children:t.jsx(w,{slot:"start",children:t.jsx(q,{defaultHref:"/it35-lab/app"})})}),t.jsxs(u,{className:"ion-padding",children:[t.jsx(M,{children:t.jsx(D,{color:"secondary",children:t.jsx("h1",{children:"Edit Account"})})}),t.jsx("br",{}),t.jsx(R,{children:t.jsx(S,{className:"ion-justify-content-center ion-align-items-center",children:t.jsxs(I,{className:"ion-text-center",children:[E&&t.jsx(k,{style:{width:"200px",height:"200px",margin:"10px auto"},children:t.jsx(Y,{src:E,style:{objectFit:"cover"}})}),t.jsx("input",{type:"file",ref:F,style:{display:"none"},accept:"image/*",onChange:e=>{var s;const n=null===(s=e.target.files)||void 0===s?void 0:s[0];n&&(P(n),A(URL.createObjectURL(n)))}}),t.jsx(b,{expand:"block",onClick:()=>{var e;return null===(e=F.current)||void 0===e?void 0:e.click()},children:"Upload Avatar"})]})})}),t.jsxs(R,{children:[t.jsx(S,{children:t.jsx(I,{children:t.jsx(v,{label:"Username",type:"text",labelPlacement:"floating",fill:"outline",placeholder:"Enter username",value:f,onIonChange:e=>C(e.detail.value)})})}),t.jsxs(S,{children:[t.jsx(I,{size:"6",children:t.jsx(v,{label:"First Name",type:"text",labelPlacement:"floating",fill:"outline",placeholder:"Enter First Name",value:j,onIonChange:e=>p(e.detail.value)})}),t.jsx(I,{size:"6",children:t.jsx(v,{label:"Last Name",type:"text",labelPlacement:"floating",fill:"outline",placeholder:"Enter Last Name",value:m,onIonChange:e=>g(e.detail.value)})})]})]}),t.jsx(R,{children:t.jsxs(S,{children:[t.jsx(D,{color:"secondary",children:t.jsx("h3",{children:"Change Password"})}),t.jsx(I,{size:"12",children:t.jsx(v,{label:"New Password",type:"password",labelPlacement:"floating",fill:"outline",placeholder:"Enter New Password",value:i,onIonChange:e=>d(e.detail.value),children:t.jsx(y,{slot:"end"})})})]})}),t.jsx(R,{children:t.jsx(S,{children:t.jsx(I,{size:"12",children:t.jsx(v,{label:"Confirm Password",type:"password",labelPlacement:"floating",fill:"outline",placeholder:"Confirm New Password",value:h,onIonChange:e=>x(e.detail.value),children:t.jsx(y,{slot:"end"})})})})}),t.jsx(R,{children:t.jsxs(S,{children:[t.jsx(D,{color:"secondary",children:t.jsx("h3",{children:"Confirm Changes"})}),t.jsx(I,{size:"12",children:t.jsx(v,{label:"Current Password",type:"password",labelPlacement:"floating",fill:"outline",placeholder:"Enter Current Password to Save Changess",value:a,onIonChange:e=>r(e.detail.value),children:t.jsx(y,{slot:"end"})})})]})}),t.jsx(b,{expand:"full",onClick:async()=>{if(i!==h)return N("Passwords don't match."),void L(!0);const{data:e,error:n}=await s.auth.getSession();if(n||!e||!e.session)return N("Error fetching session or no session available."),void L(!0);const t=e.session.user;if(!t.email)return N("Error: User email is missing."),void L(!0);const{error:l}=await s.auth.signInWithPassword({email:t.email,password:a});if(l)return N("Incorrect current password."),void L(!0);let r=E;if(_){const e=_.name.split(".").pop(),n=`avatars/${Date.now()}.${e}`,{data:t,error:l}=await s.storage.from("user-avatars").upload(n,_,{cacheControl:"3600",upsert:!0});if(l)return N(`Avatar upload failed: ${l.message}`),void L(!0);const{data:a}=s.storage.from("user-avatars").getPublicUrl(n);r=a.publicUrl}const{error:o}=await s.from("users").update({user_firstname:j,user_lastname:m,user_avatar_url:r,username:f}).eq("user_email",t.email);if(o)return N(o.message),void L(!0);if(i){const{error:e}=await s.auth.updateUser({password:i});if(e)return N(e.message),void L(!0)}N("Account updated successfully!"),L(!0),U.push("/it35-lab/app")},shape:"round",children:"Update Account"}),t.jsx(T,{isOpen:O,onDidDismiss:()=>L(!1),message:z,buttons:["OK"]})]})]})},pe=()=>{const e=[{name:"Home",url:"/it35-lab/app/home",icon:Q},{name:"About",url:"/it35-lab/app/about",icon:ee},{name:"Profile",url:"/it35-lab/app/profile",icon:se}];return t.jsx(o,{children:t.jsxs(Z,{contentId:"main",children:[t.jsxs(X,{contentId:"main",children:[t.jsx(c,{children:t.jsx(d,{children:t.jsx(h,{children:"Menu"})})}),t.jsxs(u,{fullscreen:!0,children:[e.map(((e,s)=>t.jsx(V,{children:t.jsxs(M,{routerLink:e.url,routerDirection:"forward",children:[t.jsx(E,{icon:e.icon,slot:"start"}),e.name]})},s))),t.jsxs(b,{routerLink:"/it35-lab",routerDirection:"back",expand:"full",children:[t.jsx(E,{icon:"logOutline",slot:"start"}),"Logout"]})]})]}),t.jsxs(J,{id:"main",children:[t.jsx(ne,{exact:!0,path:"/it35-lab/app/home",component:xe}),t.jsx(ne,{exact:!0,path:"/it35-lab/app/about",component:oe}),t.jsx(ne,{exact:!0,path:"/it35-lab/app/profile",component:je}),t.jsx(ne,{exact:!0,path:"/it35-lab/app",children:t.jsx(te,{to:"/it35-lab/app/home"})})]})]})})},me=()=>{r();const[e,l]=n.useState(""),[a,i]=n.useState(""),[w,C]=n.useState(""),[_,S]=n.useState(""),[I,k]=n.useState(""),[P,E]=n.useState(!1),[D,A]=n.useState(!1),[L,z]=n.useState(!1);return t.jsxs(o,{children:[t.jsx(c,{children:t.jsx(d,{children:t.jsx(h,{children:"Signup"})})}),t.jsxs(u,{children:[t.jsxs(x,{style:{height:"90%"},children:[t.jsx(j,{children:t.jsx(p,{children:"Create an Account"})}),t.jsx(m,{children:t.jsxs(g,{children:[t.jsx(f,{position:"stacked",children:"Username"}),t.jsx(v,{fill:"outline",type:"text",placeholder:"Enter a unique username",value:_,onIonChange:e=>S(e.detail.value)}),t.jsxs("div",{style:{marginTop:10},children:[t.jsx(f,{position:"stacked",children:"Email"}),t.jsx(v,{type:"email",placeholder:"Enter a valid nbsc.edu.ph email",value:e,onIonChange:e=>l(e.detail.value),fill:"outline"})]}),t.jsxs("div",{style:{marginTop:10},children:[t.jsx(f,{position:"stacked",children:"Password"}),t.jsx(v,{type:"password",value:a,onIonChange:e=>i(e.detail.value),placeholder:"************",fill:"outline",children:t.jsx(y,{slot:"end"})})]}),t.jsxs("div",{style:{marginTop:10},children:[t.jsx(f,{position:"stacked",children:"Confirm Password"}),t.jsx(v,{type:"password",value:w,onIonChange:e=>C(e.detail.value),placeholder:"************",fill:"outline",children:t.jsx(y,{slot:"end"})})]}),t.jsx(b,{onClick:()=>e.endsWith("@nbsc.edu.ph")?a!==w?(k("Passwords do not match."),void E(!0)):void A(!0):(k("Only @nbsc.edu.ph emails are allowed to register."),void E(!0)),expand:"block",style:{marginTop:20},children:"Signup"}),t.jsxs("div",{style:{textAlign:"center",marginTop:"20vh"},children:[t.jsx("span",{children:"Already have an account? "}),t.jsx(re,{to:"/it35-lab/",children:"Login"})]})]})})]}),t.jsx(T,{isOpen:P,onDidDismiss:()=>E(!1),header:"Error🔴",message:I,buttons:["OK"]}),t.jsx(O,{isOpen:D,children:t.jsx(u,{children:t.jsxs("div",{style:{padding:20,textAlign:"center"},children:[t.jsx("h2",{children:"Verify Your Information"}),t.jsx("p",{children:"Are you sure you want to proceed with the registration?"}),t.jsx(b,{onClick:async()=>{A(!1);try{const{data:n,error:t}=await s.auth.signUp({email:e,password:a});if(t)throw new Error("Account creation failed: "+t.message);const l=await ae.genSalt(10),r=await ae.hash(a,l),{error:i}=await s.from("users").insert([{username:_,user_email:e,user_password:r}]);if(i)throw new Error("Failed to save user data: "+i.message);z(!0)}catch(n){n instanceof Error?k(n.message):k("An unknown error occurred."),E(!0)}},expand:"block",style:{marginTop:20},children:"Confirm"}),t.jsx(b,{onClick:()=>A(!1),expand:"block",color:"light",style:{marginTop:10},children:"Cancel"})]})})}),t.jsx(O,{isOpen:L,onDidDismiss:()=>z(!1),children:t.jsx(u,{children:t.jsxs("div",{style:{padding:20,textAlign:"center"},children:[t.jsx("h2",{children:"Registration Successful"}),t.jsx("p",{children:"You have successfully registered. Please check your email for verification."}),t.jsx(b,{onClick:()=>z(!1),expand:"block",style:{marginTop:20},routerLink:"/it35-lab/",children:"Close"})]})})})]})]})};W();const ge=()=>t.jsx(_,{children:t.jsx(z,{children:t.jsxs(J,{children:[t.jsx(ne,{exact:!0,path:"/it35-lab",component:ie}),t.jsx(ne,{path:"/it35-lab/app",component:pe}),t.jsx(ne,{path:"/it35-lab/signup",component:me})]})})}),fe=document.getElementById("root");a(fe).render(t.jsx(l.StrictMode,{children:t.jsx(ge,{})}))}}}));
