import{r as t,j as e,R as ge}from"./react-CV32Oo2A.js";import{c as ve}from"./react-dom-BE8KJt4u.js";import{u as ce,a as ye,I as T,b as P,c as O,d as L,e as I,f as W,g as G,h as $,i as Q,j as de,k as N,l as g,m as q,n as m,o as Y,p as se,q as ue,r as R,s as S,t as he,v as Ie,w as ee,x as X,y as be,z as te,A as we,B as re,C as pe,D as Ce,E as Se,F as Pe,G as ne,H as _e,J as xe,K as H,L as Ee,M as ke,N as Ae,O as Oe,P as Le}from"./@ionic-9Ud99FWD.js";import{c as Te}from"./@supabase-BL7X6eIb.js";import{p as De,b as Ue,s as Me,a as Ne,h as Fe,r as Re,c as ze}from"./ionicons-CyKgUEEy.js";import{R as w,b as je,u as Be}from"./react-router-jI_Y6ygA.js";import{b as le}from"./bcryptjs-DmB7UM2u.js";import{L as Je}from"./react-router-dom-QjQJqGuS.js";import"./scheduler-CylivXx-.js";import"./@stencil-CPeMEfU_.js";import"./tslib-BGVaTf34.js";import"./history-BonCrwGP.js";import"./@babel-D0iV5qdj.js";import"./resolve-pathname-D6XOvX2q.js";import"./value-equal-epUc6GCk.js";import"./tiny-invariant-BaFNuDhB.js";import"./prop-types-fvBu4ia4.js";import"./path-to-regexp-C6T5V3rG.js";import"./isarray-Dmh8zLWU.js";import"./hoist-non-react-statics-B5si56_W.js";function as(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))f(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const x of l.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&f(x)}).observe(document,{childList:!0,subtree:!0});function a(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function f(r){if(r.ep)return;r.ep=!0;const l=a(r);fetch(r.href,l)}})();const qe="https://yzernezvbwxkornfzxbn.supabase.co",Ve="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl6ZXJuZXp2Ynd4a29ybmZ6eGJuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDMyMTI1MzUsImV4cCI6MjA1ODc4ODUzNX0.34sRdyY_9NDzS83SDPp2AZfjanLBer3V4i_7V8Qqa-g",d=Te(qe,Ve),He=()=>{const[u]=ce(),n=ye(),[a,f]=t.useState(""),[r,l]=t.useState(""),[x,D]=t.useState(!1),_=(v,h)=>{u({color:"danger",message:h,duration:1500,position:v})},b=async()=>{let{data:v,error:h}=await d.auth.signInWithPassword({email:a,password:r});if(h){_("top",h.message),D(!0);return}setTimeout(()=>{n.push("/it35-lab/app","forward","replace")},300)};return e.jsxs(T,{children:[e.jsx(P,{children:e.jsx(O,{children:e.jsx(L,{children:"Login"})})}),e.jsx(I,{className:"",children:e.jsxs(W,{style:{height:"90%"},children:[e.jsx(G,{children:e.jsx($,{})}),e.jsx(Q,{children:e.jsxs(de,{children:[e.jsxs("div",{children:[e.jsx(N,{position:"stacked",children:"Email"}),e.jsx(g,{type:"email",value:a,onIonChange:v=>f(v.detail.value),fill:"outline",errorText:"Invalid email"})]}),e.jsxs("div",{style:{marginTop:10},children:[e.jsx(N,{position:"stacked",children:"Password"}),e.jsx(g,{type:"password",value:r,onIonChange:v=>l(v.detail.value),placeholder:"************",fill:"outline",style:{marginTop:0},children:e.jsx(q,{slot:"end"})})]}),e.jsx(m,{onClick:()=>b(),expand:"block",style:{marginTop:20},children:"Login"}),e.jsx("div",{style:{textAlign:"center",marginTop:"40vh"},children:e.jsx("span",{children:"Don't have an account yet? "})}),e.jsx(m,{routerLink:"/it35-lab/signup",expand:"block",style:{marginTop:10},children:"Signup"})]})})]})})]})},Ye=()=>e.jsxs(T,{children:[e.jsx(P,{children:e.jsxs(O,{children:[e.jsx(Y,{slot:"start",children:e.jsx(se,{})}),e.jsx(L,{children:"About"})]})}),e.jsx(I,{fullscreen:!0})]}),Ze=()=>e.jsxs(T,{children:[e.jsx(P,{children:e.jsxs(O,{children:[e.jsx(Y,{slot:"start",children:e.jsx(se,{})}),e.jsx(L,{children:"Favorites"})]})}),e.jsx(I,{fullscreen:!0,children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:"Favorites"})})]}),Ke=()=>e.jsxs(T,{children:[e.jsx(P,{children:e.jsxs(O,{children:[e.jsx(Y,{slot:"start",children:e.jsx(se,{})}),e.jsx(L,{children:"Search"})]})}),e.jsx(I,{fullscreen:!0,children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:"Search"})})]}),Xe=()=>{const[u,n]=t.useState([]),[a,f]=t.useState(""),[r,l]=t.useState(null),[x,D]=t.useState(null),[_,b]=t.useState(null),[v,h]=t.useState(!1),[z,E]=t.useState(!1),[k,C]=t.useState({open:!1,event:null,postId:null});t.useEffect(()=>{const s=async()=>{var y,J;const{data:c}=await d.auth.getUser();if((J=(y=c==null?void 0:c.user)==null?void 0:y.email)!=null&&J.endsWith("@nbsc.edu.ph")){D(c.user);const{data:V,error:i}=await d.from("users").select("user_id, username, user_avatar_url").eq("user_email",c.user.email).single();!i&&V&&(D({...c.user,id:V.user_id}),b(V.username))}},o=async()=>{const{data:c,error:y}=await d.from("posts").select("*").order("post_created_at",{ascending:!1});y||n(c)};s(),o()},[]);const F=async()=>{if(!a||!x||!_)return;const{data:s,error:o}=await d.from("users").select("user_avatar_url").eq("user_id",x.id).single();if(o){console.error("Error fetching user avatar:",o);return}const c=(s==null?void 0:s.user_avatar_url)||"https://ionicframework.com/docs/img/demos/avatar.svg",{data:y,error:J}=await d.from("posts").insert([{post_content:a,user_id:x.id,username:_,avatar_url:c}]).select("*");!J&&y&&n([y[0],...u]),f("")},B=async s=>{await d.from("posts").delete().match({post_id:s}),n(u.filter(o=>o.post_id!==s))},j=s=>{l(s),f(s.post_content),h(!0)},p=async()=>{if(!a||!r)return;const{data:s,error:o}=await d.from("posts").update({post_content:a}).match({post_id:r.post_id}).select("*");if(!o&&s){const c=s[0];n(u.map(y=>y.post_id===c.post_id?c:y)),f(""),l(null),h(!1),E(!0)}};return e.jsx(ue,{children:e.jsxs(T,{children:[e.jsx(P,{children:e.jsx(O,{children:e.jsx(L,{children:"Posts"})})}),e.jsx(I,{children:x?e.jsxs(e.Fragment,{children:[e.jsxs(W,{children:[e.jsx(G,{children:e.jsx($,{children:"Create Post"})}),e.jsx(Q,{children:e.jsx(g,{value:a,onIonChange:s=>f(s.detail.value),placeholder:"Write a post..."})}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",padding:"0.5rem"},children:e.jsx(m,{onClick:F,children:"Post"})})]}),u.map(s=>e.jsxs(W,{style:{marginTop:"2rem"},children:[e.jsx(G,{children:e.jsxs(R,{children:[e.jsx(S,{size:"1.85",children:e.jsx(he,{children:e.jsx("img",{alt:s.username,src:s.avatar_url})})}),e.jsxs(S,{children:[e.jsx($,{style:{marginTop:"10px"},children:s.username}),e.jsx(Ie,{children:new Date(s.post_created_at).toLocaleString()})]}),e.jsx(S,{size:"auto",children:e.jsx(m,{fill:"clear",onClick:o=>C({open:!0,event:o.nativeEvent,postId:s.post_id}),children:e.jsx(ee,{color:"secondary",icon:De})})})]})}),e.jsx(Q,{children:e.jsx(X,{style:{color:"black"},children:e.jsx("h1",{children:s.post_content})})}),e.jsxs(be,{isOpen:k.open&&k.postId===s.post_id,event:k.event,onDidDismiss:()=>C({open:!1,event:null,postId:null}),children:[e.jsx(m,{fill:"clear",onClick:()=>{j(s),C({open:!1,event:null,postId:null})},children:"Edit"}),e.jsx(m,{fill:"clear",color:"danger",onClick:()=>{B(s.post_id),C({open:!1,event:null,postId:null})},children:"Delete"})]})]},s.post_id))]}):e.jsx(N,{children:"Loading..."})}),e.jsxs(te,{isOpen:v,onDidDismiss:()=>h(!1),children:[e.jsx(P,{children:e.jsx(O,{children:e.jsx(L,{children:"Edit Post"})})}),e.jsx(I,{children:e.jsx(g,{value:a,onIonChange:s=>f(s.detail.value),placeholder:"Edit your post..."})}),e.jsxs(we,{children:[e.jsx(m,{onClick:p,children:"Save"}),e.jsx(m,{onClick:()=>h(!1),children:"Cancel"})]})]}),e.jsx(re,{isOpen:z,onDidDismiss:()=>E(!1),header:"Success",message:"Post updated successfully!",buttons:["OK"]})]})})},We=()=>e.jsxs(T,{children:[e.jsx(P,{children:e.jsxs(O,{children:[e.jsx(Y,{slot:"start",children:e.jsx(se,{})}),e.jsx(L,{children:"Feed"})]})}),e.jsxs(I,{fullscreen:!0,children:[e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:"Feed"}),e.jsx(Xe,{})]})]});function Ge(){const u=[{name:"Feed",tab:"feed",url:"/it35-lab/app/home/feed",icon:Ue},{name:"Search",tab:"search",url:"/it35-lab/app/home/search",icon:Me},{name:"Favorites",tab:"favorites",url:"/it35-lab/app/home/favorites",icon:Ne}];return e.jsx(pe,{children:e.jsxs(Ce,{children:[e.jsx(Se,{slot:"bottom",children:u.map((n,a)=>e.jsxs(Pe,{tab:n.tab,href:n.url,children:[e.jsx(ee,{icon:n.icon,children:" "}),e.jsxs(N,{children:[" ",n.name," "]})]},a))}),e.jsxs(ne,{children:[e.jsx(w,{exact:!0,path:"/it35-lab/app/home/feed",render:We}),e.jsx(w,{exact:!0,path:"/it35-lab/app/home/search",render:Ke}),e.jsx(w,{exact:!0,path:"/it35-lab/app/home/favorites",render:Ze}),e.jsx(w,{exact:!0,path:"/it35-lab/app/home",children:e.jsx(je,{to:"/it35-lab/app/home/feed"})})]})]})})}const $e=()=>{const[u,n]=t.useState(""),[a,f]=t.useState(""),[r,l]=t.useState(""),[x,D]=t.useState(""),[_,b]=t.useState(""),[v,h]=t.useState(""),[z,E]=t.useState(""),[k,C]=t.useState(null),[F,B]=t.useState(null),[j,p]=t.useState(!1),[s,o]=t.useState(""),c=Be(),y=t.useRef(null);t.useEffect(()=>{(async()=>{const{data:A,error:U}=await d.auth.getSession();if(U||!A||!A.session){o("You must be logged in to access this page."),p(!0),c.push("/it35-lab/login");return}const{data:M,error:Z}=await d.from("users").select("user_firstname, user_lastname, user_avatar_url, user_email, username").eq("user_email",A.session.user.email).single();if(Z||!M){o("User data not found."),p(!0);return}b(M.user_firstname||""),h(M.user_lastname||""),B(M.user_avatar_url),n(M.user_email),E(M.username||"")})()},[c]);const J=i=>{var U;const A=(U=i.target.files)==null?void 0:U[0];A&&(C(A),B(URL.createObjectURL(A)))},V=async()=>{if(r!==x){o("Passwords don't match."),p(!0);return}const{data:i,error:A}=await d.auth.getSession();if(A||!i||!i.session){o("Error fetching session or no session available."),p(!0);return}const U=i.session.user;if(!U.email){o("Error: User email is missing."),p(!0);return}const{error:M}=await d.auth.signInWithPassword({email:U.email,password:a});if(M){o("Incorrect current password."),p(!0);return}let Z=F;if(k){const K=k.name.split(".").pop(),me="".concat(Date.now(),".").concat(K),oe="avatars/".concat(me),{data:ns,error:ie}=await d.storage.from("user-avatars").upload(oe,k,{cacheControl:"3600",upsert:!0});if(ie){o("Avatar upload failed: ".concat(ie.message)),p(!0);return}const{data:fe}=d.storage.from("user-avatars").getPublicUrl(oe);Z=fe.publicUrl}const{error:ae}=await d.from("users").update({user_firstname:_,user_lastname:v,user_avatar_url:Z,username:z}).eq("user_email",U.email);if(ae){o(ae.message),p(!0);return}if(r){const{error:K}=await d.auth.updateUser({password:r});if(K){o(K.message),p(!0);return}}o("Account updated successfully!"),p(!0),c.push("/it35-lab/app")};return e.jsxs(T,{children:[e.jsx(P,{children:e.jsx(Y,{slot:"start",children:e.jsx(_e,{defaultHref:"/it35-lab/app"})})}),e.jsxs(I,{className:"ion-padding",children:[e.jsx(xe,{children:e.jsx(X,{color:"secondary",children:e.jsx("h1",{children:"Edit Account"})})}),e.jsx("br",{}),e.jsx(H,{children:e.jsx(R,{className:"ion-justify-content-center ion-align-items-center",children:e.jsxs(S,{className:"ion-text-center",children:[F&&e.jsx(he,{style:{width:"200px",height:"200px",margin:"10px auto"},children:e.jsx(Ee,{src:F,style:{objectFit:"cover"}})}),e.jsx("input",{type:"file",ref:y,style:{display:"none"},accept:"image/*",onChange:J}),e.jsx(m,{expand:"block",onClick:()=>{var i;return(i=y.current)==null?void 0:i.click()},children:"Upload Avatar"})]})})}),e.jsxs(H,{children:[e.jsx(R,{children:e.jsx(S,{children:e.jsx(g,{label:"Username",type:"text",labelPlacement:"floating",fill:"outline",placeholder:"Enter username",value:z,onIonChange:i=>E(i.detail.value)})})}),e.jsxs(R,{children:[e.jsx(S,{size:"6",children:e.jsx(g,{label:"First Name",type:"text",labelPlacement:"floating",fill:"outline",placeholder:"Enter First Name",value:_,onIonChange:i=>b(i.detail.value)})}),e.jsx(S,{size:"6",children:e.jsx(g,{label:"Last Name",type:"text",labelPlacement:"floating",fill:"outline",placeholder:"Enter Last Name",value:v,onIonChange:i=>h(i.detail.value)})})]})]}),e.jsx(H,{children:e.jsxs(R,{children:[e.jsx(X,{color:"secondary",children:e.jsx("h3",{children:"Change Password"})}),e.jsx(S,{size:"12",children:e.jsx(g,{label:"New Password",type:"password",labelPlacement:"floating",fill:"outline",placeholder:"Enter New Password",value:r,onIonChange:i=>l(i.detail.value),children:e.jsx(q,{slot:"end"})})})]})}),e.jsx(H,{children:e.jsx(R,{children:e.jsx(S,{size:"12",children:e.jsx(g,{label:"Confirm Password",type:"password",labelPlacement:"floating",fill:"outline",placeholder:"Confirm New Password",value:x,onIonChange:i=>D(i.detail.value),children:e.jsx(q,{slot:"end"})})})})}),e.jsx(H,{children:e.jsxs(R,{children:[e.jsx(X,{color:"secondary",children:e.jsx("h3",{children:"Confirm Changes"})}),e.jsx(S,{size:"12",children:e.jsx(g,{label:"Current Password",type:"password",labelPlacement:"floating",fill:"outline",placeholder:"Enter Current Password to Save Changess",value:a,onIonChange:i=>f(i.detail.value),children:e.jsx(q,{slot:"end"})})})]})}),e.jsx(m,{expand:"full",onClick:V,shape:"round",children:"Update Account"}),e.jsx(re,{isOpen:j,onDidDismiss:()=>p(!1),message:s,buttons:["OK"]})]})]})},Qe=()=>{const u=[{name:"Home",url:"/it35-lab/app/home",icon:Fe},{name:"About",url:"/it35-lab/app/about",icon:Re},{name:"Profile",url:"/it35-lab/app/profile",icon:ze}];return e.jsx(T,{children:e.jsxs(ke,{contentId:"main",children:[e.jsxs(Ae,{contentId:"main",children:[e.jsx(P,{children:e.jsx(O,{children:e.jsx(L,{children:"Menu"})})}),e.jsxs(I,{fullscreen:!0,children:[u.map((n,a)=>e.jsx(Oe,{children:e.jsxs(xe,{routerLink:n.url,routerDirection:"forward",children:[e.jsx(ee,{icon:n.icon,slot:"start"}),n.name]})},a)),e.jsxs(m,{routerLink:"/it35-lab",routerDirection:"back",expand:"full",children:[e.jsx(ee,{icon:"logOutline",slot:"start"}),"Logout"]})]})]}),e.jsxs(ne,{id:"main",children:[e.jsx(w,{exact:!0,path:"/it35-lab/app/home",component:Ge}),e.jsx(w,{exact:!0,path:"/it35-lab/app/about",component:Ye}),e.jsx(w,{exact:!0,path:"/it35-lab/app/profile",component:$e}),e.jsx(w,{exact:!0,path:"/it35-lab/app",children:e.jsx(je,{to:"/it35-lab/app/home"})})]})]})})},es=()=>{ce();const[u,n]=t.useState(""),[a,f]=t.useState(""),[r,l]=t.useState(""),[x,D]=t.useState(""),[_,b]=t.useState(""),[v,h]=t.useState(!1),[z,E]=t.useState(!1),[k,C]=t.useState(!1),F=()=>{if(!u.endsWith("@nbsc.edu.ph")){b("Only @nbsc.edu.ph emails are allowed to register."),h(!0);return}if(a!==r){b("Passwords do not match."),h(!0);return}E(!0)},B=async()=>{E(!1);try{const{data:j,error:p}=await d.auth.signUp({email:u,password:a});if(p)throw new Error("Account creation failed: "+p.message);const s=await le.genSalt(10),o=await le.hash(a,s),{error:c}=await d.from("users").insert([{username:x,user_email:u,user_password:o}]);if(c)throw new Error("Failed to save user data: "+c.message);C(!0)}catch(j){j instanceof Error?b(j.message):b("An unknown error occurred."),h(!0)}};return e.jsxs(T,{children:[e.jsx(P,{children:e.jsx(O,{children:e.jsx(L,{children:"Signup"})})}),e.jsxs(I,{children:[e.jsxs(W,{style:{height:"90%"},children:[e.jsx(G,{children:e.jsx($,{children:"Create an Account"})}),e.jsx(Q,{children:e.jsxs(de,{children:[e.jsx(N,{position:"stacked",children:"Username"}),e.jsx(g,{fill:"outline",type:"text",placeholder:"Enter a unique username",value:x,onIonChange:j=>D(j.detail.value)}),e.jsxs("div",{style:{marginTop:10},children:[e.jsx(N,{position:"stacked",children:"Email"}),e.jsx(g,{type:"email",placeholder:"Enter a valid nbsc.edu.ph email",value:u,onIonChange:j=>n(j.detail.value),fill:"outline"})]}),e.jsxs("div",{style:{marginTop:10},children:[e.jsx(N,{position:"stacked",children:"Password"}),e.jsx(g,{type:"password",value:a,onIonChange:j=>f(j.detail.value),placeholder:"************",fill:"outline",children:e.jsx(q,{slot:"end"})})]}),e.jsxs("div",{style:{marginTop:10},children:[e.jsx(N,{position:"stacked",children:"Confirm Password"}),e.jsx(g,{type:"password",value:r,onIonChange:j=>l(j.detail.value),placeholder:"************",fill:"outline",children:e.jsx(q,{slot:"end"})})]}),e.jsx(m,{onClick:F,expand:"block",style:{marginTop:20},children:"Signup"}),e.jsxs("div",{style:{textAlign:"center",marginTop:"20vh"},children:[e.jsx("span",{children:"Already have an account? "}),e.jsx(Je,{to:"/it35-lab/",children:"Login"})]})]})})]}),e.jsx(re,{isOpen:v,onDidDismiss:()=>h(!1),header:"Error🔴",message:_,buttons:["OK"]}),e.jsx(te,{isOpen:z,children:e.jsx(I,{children:e.jsxs("div",{style:{padding:20,textAlign:"center"},children:[e.jsx("h2",{children:"Verify Your Information"}),e.jsx("p",{children:"Are you sure you want to proceed with the registration?"}),e.jsx(m,{onClick:B,expand:"block",style:{marginTop:20},children:"Confirm"}),e.jsx(m,{onClick:()=>E(!1),expand:"block",color:"light",style:{marginTop:10},children:"Cancel"})]})})}),e.jsx(te,{isOpen:k,onDidDismiss:()=>C(!1),children:e.jsx(I,{children:e.jsxs("div",{style:{padding:20,textAlign:"center"},children:[e.jsx("h2",{children:"Registration Successful"}),e.jsx("p",{children:"You have successfully registered. Please check your email for verification."}),e.jsx(m,{onClick:()=>C(!1),expand:"block",style:{marginTop:20},routerLink:"/it35-lab/",children:"Close"})]})})})]})]})};Le();const ss=()=>e.jsx(ue,{children:e.jsx(pe,{children:e.jsxs(ne,{children:[e.jsx(w,{exact:!0,path:"/it35-lab",component:He}),e.jsx(w,{path:"/it35-lab/app",component:Qe}),e.jsx(w,{path:"/it35-lab/signup",component:es})]})})}),ts=document.getElementById("root"),rs=ve(ts);rs.render(e.jsx(ge.StrictMode,{children:e.jsx(ss,{})}));export{as as __vite_legacy_guard};
